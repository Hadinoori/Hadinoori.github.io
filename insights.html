async function loadInsights() {
    const container = document.getElementById('insights-container');
    if (!container) return;

    try {
        const res = await fetch('/insights.json?v=' + new Date().getTime());
        if (!res.ok) throw new Error("Index file not found");
        
        const posts = await res.json();

        container.innerHTML = posts.map(post => {
            const dateObj = new Date(post.date);
            const displayDate = dateObj.toLocaleDateString('en-US', { 
                month: 'short', year: 'numeric' 
            }).toUpperCase();

            // FIX: Ensure the link points to the actual HTML file in the insights folder
            // If post.url is "2026-01-25-test", it converts to "/insights/2026-01-25-test.html"
            const finalLink = post.is_external ? post.url : `/${post.url}.html`;

            return `
                <div style="border-bottom: 1px solid var(--ui-border);">
                    <div class="entry">
                        <div class="meta-spine">
                            ${displayDate} / ${post.is_external ? 'DISPATCH' : 'INSIGHT'}
                        </div>
                        <div class="item-body">
                            <h3 class="entry-title">
                                <a href="${finalLink}" ${post.is_external ? 'target="_blank"' : ''} style="text-decoration:none; color:inherit;">
                                    ${post.title} ${post.is_external ? 'â†—' : ''}
                                </a>
                            </h3>
                            <p style="color: var(--text-muted); font-size: 1.1rem; max-width: 52ch; margin:0; line-height: 1.6;">
                                ${post.description}
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
        
    } catch (e) {
        console.error("Archive Load Error:", e);
    }
}
window.onload = loadInsights;
