<div class="label" style="margin-top: 100px; margin-bottom: 20px;">
    SELECTED DISPATCH.
</div>

<div id="selected-dispatch-container">
    </div>

<hr style="margin-top: 60px; margin-bottom: 40px; border: 0; border-top: 1px solid #eee;">

<script>
    (async function() {
        const container = document.getElementById('selected-dispatch-container');
        const REPO = 'hadinoori/hadinoori.github.io';
        
        try {
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/_insights`);
            const files = await res.json();
            const mdFiles = files.filter(f => f.name.endsWith('.md')).reverse();

            let targetContent = null;
            for (let file of mdFiles) {
                const fRes = await fetch(file.download_url);
                const text = await fRes.text();
                // Matching the exact field from your dashboard
                if (text.includes('selected_dispatch: true')) {
                    targetContent = text;
                    break;
                }
            }

            // Fallback to the latest if nothing is selected
            if (!targetContent && mdFiles.length > 0) {
                const fallbackRes = await fetch(mdFiles[0].download_url);
                targetContent = await fallbackRes.text();
            }

            if (targetContent) {
                const title = targetContent.match(/title:\s*"(.*)"/)?.[1] || "Untitled Inquiry";
                const date = targetContent.match(/date:\s*(.*)/)?.[1] || "";
                const desc = targetContent.match(/description:\s*"(.*)"/)?.[1] || "";
                
                // Format Date: JAN 2026
                const dateObj = new Date(date);
                const displayDate = dateObj.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }).toUpperCase();

                // Injecting using the exact CSS classes of your template
                container.innerHTML = `
                    <div class="entry">
                        <div class="date">${displayDate} / SELECTED</div>
                        <div class="content">
                            <h2 class="manifesto-title" style="margin-top: 0; font-size: 2.8rem; line-height: 1.1;">${title}</h2>
                            <p class="description" style="font-size: 1.1rem; color: #555; line-height: 1.6;">${desc}</p>
                        </div>
                    </div>
                `;
            }
        } catch (e) {
            console.error("Home Layout Sync Error:", e);
        }
    })();
</script>
